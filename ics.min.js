"use strict"; !function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.ics = t() }(this, function () { var e = { convert: function (e, t) { return "boolean" == typeof e && (e = e ? t || "TRUE" : "FALSE"), e }, format: function (e, t) { return (t || "").replace(/,/g, "\\,").replace(/;/g, "\\;").replace(/\n/g, "\\n") + (e ? ":" + e.replace(/,/g, "\\,").replace(/;/g, "\\;").replace(/\n/g, "\\n") : "") }, fold: function (e) { return e.match(/(.{1,75})/g).join("\r\n ") } }; return function (t, n) { if ("undefined" == typeof window && "undefined" == typeof self || "undefined" != typeof navigator && navigator.msSaveOrOpenBlob || "undefined" != typeof navigator && navigator.product && "Gecko" === navigator.product) return void 0 === n && (n = t, t = void 0), { events: [], calendars: [], addEvent: function (e, t, n, a, i, o) { if (null == e || null == t || null == n || null == a || null == i) return !1; var r, s, l, d; if (o) { if (!o.rrule) return console.warn("Recurrence rrule must be provided"), !1; s = o.rrule } var c = (new Date).toISOString(); return this.events.push({ summary: e, description: t, location: n, start: a, end: i, rrule: s, dtstamp: c, uid: o && o.uid || Date.now().toString(36) + Math.random().toString(36).substr(2), organizer: o && o.organizer || null, attendees: o && o.attendees || null, alarms: o && o.alarms || null, categories: o && o.categories || null, status: o && o.status || null, transp: o && o.transp || null }), this }, addCalendar: function (e, t, n, a, i) { if (null == e || null == t || null == n || null == a || null == i) return !1; var o = (new Date).toISOString(); return this.calendars.push({ summary: e, description: t, location: n, start: a, end: i, dtstamp: o }), this }, calendar: function (e) { return function (t, r) { var a, i = ["BEGIN:VCALENDAR", "PRODID:" + e.format(r.prodid || "ics.js - http://github.com/nwcell/ics.js"), "VERSION:2.0"]; r.calscale && i.push("CALSCALE:" + e.format(r.calscale)), r.method && i.push("METHOD:" + e.format(r.method)); for (var o = 0; o < t.length; o++) { var s = t[o]; i.push("BEGIN:VEVENT"), i.push("UID:" + e.format(s.uid || i.length)), i.push("DTSTAMP:" + e.format(s.dtstamp)); var l = (s.start || "").split(" "), d = l.length > 1 ? (a = new Date(l[0] + " " + l[1]), [a.getUTCFullYear(), ("0" + (a.getUTCMonth() + 1)).slice(-2), ("0" + a.getUTCDate()).slice(-2), "T", ("0" + a.getUTCHours()).slice(-2), ("0" + a.getUTCMinutes()).slice(-2), ("0" + a.getUTCSeconds()).slice(-2), "Z"].join("")) : (a = new Date(s.start), [a.getUTCFullYear(), ("0" + (a.getUTCMonth() + 1)).slice(-2), ("0" + a.getUTCDate()).slice(-2), "T", ("0" + a.getUTCHours()).slice(-2), ("0" + a.getUTCMinutes()).slice(-2), ("0" + a.getUTCSeconds()).slice(-2), "Z"].join("")); i.push("DTSTART" + e.format(s.start_tz, d)); var c = (s.end || "").split(" "), u = c.length > 1 ? (a = new Date(c[0] + " " + c[1]), [a.getUTCFullYear(), ("0" + (a.getUTCMonth() + 1)).slice(-2), ("0" + a.getUTCDate()).slice(-2), "T", ("0" + a.getUTCHours()).slice(-2), ("0" + a.getUTCMinutes()).slice(-2), ("0" + a.getUTCSeconds()).slice(-2), "Z"].join("")) : s.end ? (a = new Date(s.end), [a.getUTCFullYear(), ("0" + (a.getUTCMonth() + 1)).slice(-2), ("0" + a.getUTCDate()).slice(-2), "T", ("0" + a.getUTCHours()).slice(-2), ("0" + a.getUTCMinutes()).slice(-2), ("0" + a.getUTCSeconds()).slice(-2), "Z"].join("")) : ""; "" !== u && i.push("DTE" + e.format(s.end_tz ? s.end_tz : "ND", u)), s.rrule && i.push("RRULE:" + e.format(s.rrule)), s.summary && "string" == typeof s.summary && i.push(e.fold("SUMMARY:" + e.format("", s.summary))), s.description && "string" == typeof s.description && i.push(e.fold("DESCRIPTION:" + e.format("", s.description))), s.location && "string" == typeof s.location && i.push(e.fold("LOCATION:" + e.format("", s.location))), s.url && "string" == typeof s.url && i.push(e.fold("URL:" + e.format("", s.url))); var p = s.organizer || r.organizer; p && i.push(e.fold("ORGANIZER;CN=" + e.format(p.name || p.email, "MAILTO:" + p.email))); var m = s.attendees || r.attendees; if (m) for (var f = 0; f < m.length; f++) { var g = function (e, t) { var r = {}; for (var a in e) r[a] = e[a]; for (var a in t) r[a] = t[a]; return r }(r.attendee || {}, m[f]); i.push(e.fold("ATTENDEE;" + Object.keys(g).filter(function (e) { return "email" !== e && "name" !== e }).map(function (e) { return e.toUpperCase() + "=" + g[e] }).join(";") + (g.name ? ";CN=" + e.format(g.name) : "") + ":MAILTO:" + g.email)) } s.alarms && s.alarms.forEach(function (t) { i.push("BEGIN:VALARM"), Object.keys(t).map(function (r) { i.push(e.fold(r.toUpperCase() + ":" + e.format("", t[r]))) }, i.push("END:VALARM")) }), s.categories && i.push(e.fold("CATEGORIES:" + e.format("", s.categories))), s.status && i.push("STATUS:" + e.format("", s.status)), s.transp && i.push("TRANSP:" + e.format("", s.transp)), i.push("END:VEVENT") } for (var o = 0; o < i.length; o++)i[o] = e.fold(i[o]); return i.push("END:VCALENDAR"), i.join("\r\n") }(this.events, function (e, t) { var r = {}; for (var a in e) r[a] = e[a]; for (var a in t) r[a] = t[a]; return r }(n || {}, e || {})) }, download: function (e, t) { if (this.events.length < 1) return !1; t = void 0 !== t ? t + ".ics" : ".ics"; var r, a = this.calendar(); if ("string" == typeof e) a = this.calendar({ categories: [e] }); else if (Array.isArray(e)) a = this.calendar({ categories: e }); if ("undefined" != typeof navigator && navigator.msSaveOrOpenBlob) try { var i = new Blob([a], { type: "text/calendar;charset=utf-8" }); return navigator.msSaveOrOpenBlob(i, e + t) } catch (e) { } if ("undefined" != typeof document) try { var o = document.createElement("a"); return o.href = "data:text/calendar;charset=utf-8," + encodeURIComponent(a), o.download = e + t, document.body.appendChild(o), o.click(), document.body.removeChild(o), !0 } catch (e) { } return a } }; console.warn("ics.js does not support this browser.") } });