<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>Dwellverse CRM</title>
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script src="js/libs/ics.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.0-rc.2/dist/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0-rc.2/dist/quill.js"></script>

    <!-- Application Stylesheet -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Immersive background element for the Vision Pro aesthetic -->
    <div class="vision-pro-background">
        <div class="gradient-orb orb1"></div>
        <div class="gradient-orb orb2"></div>
        <div class="gradient-orb orb3"></div>
    </div>

    <!-- The main application "window" or shell -->
    <div class="vision-pro-shell">
        <!-- AUTHENTICATION SECTION -->
        <div id="authSection" class="auth-section">
            <div class="auth-header">
                <img id="authLogo" src="https://dwellverse.io/wp-content/uploads/2025/05/logo.jpg" alt="Dwellverse Logo">
            </div>
            <div class="form-group"><label for="email">Email:</label><input type="email" id="email" required></div>
            <div class="form-group"><label for="password">Password:</label><input type="password" id="password" required></div>
            <button id="loginButton">Login</button>
            <p id="authError" class="auth-error-message"></p>
        </div>

        <!-- MAIN APP SECTION -->
        <div id="appSection" class="app-section">
            <nav class="top-navigation-bar">
                <ul>
                    <li class="nav-profile-item">
                        <a href="#profile" data-page="profile" id="userProfileCircleContainer">
                            <div id="userProfileCircle"></div>
                        </a>
                    </li>
                    <li><a href="#dashboard" data-page="dashboard" class="nav-link"><span class="nav-icon">📊</span> Dashboard</a></li>
                    <li><a href="#pipeline" data-page="pipeline" class="nav-link"><span class="nav-icon">🪟</span> Pipeline</a></li>
                    <li><a href="#leads" data-page="leads" class="nav-link"><span class="nav-icon">👥</span> Leads</a></li>
                    <li><a href="#tasks" data-page="tasks" class="nav-link"><span class="nav-icon">📋</span> Tasks</a></li>
                    <li><a href="#calendar" data-page="calendar" class="nav-link"><span class="nav-icon">📅</span> Calendar</a></li>
                    <li><a href="#email" data-page="email" class="nav-link"><span class="nav-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" style="vertical-align: -0.15em;"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></svg></span> Email</a></li>
                    <li><a href="#documents" data-page="documents" class="nav-link"><span class="nav-icon">📄</span> Documents</a></li>
                    <li><a href="#drip" data-page="drip" class="nav-link"><span class="nav-icon">💧</span> Drip</a></li>
                    <li><a href="#capture" data-page="capture" class="nav-link"><span class="nav-icon">➕</span> Capture</a></li>
                    <li class="nav-actions-group">
                        <button id="darkModeToggle" class="button-glass-subtle">🌙</button>
                        <button id="logoutButton" class="button-glass-subtle danger-text">Logout</button>
                    </li>
                </ul>
            </nav>
            <main id="app-content"></main>
        </div>
    </div>

    <!-- GLOBAL MODALS -->
    <!-- Lead Modal -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeLeadModalButton">×</span>
            <h2 id="leadModalTitle">Add New Lead</h2>
            <form id="leadForm" class="modal-form-grid">
                <input type="hidden" id="leadId">
                <div class="grid-col-span-2 form-group"><label for="leadNameModal">Name</label><input type="text" id="leadNameModal" required></div>
                <div class="form-group"><label for="leadEmailModal">Email</label><input type="email" id="leadEmailModal"></div>
                <div class="form-group"><label for="leadPhoneModal">Phone</label><input type="tel" id="leadPhoneModal"></div>
                <div class="form-group"><label for="leadPropertyAddressModal">Property Address</label><input type="text" id="leadPropertyAddressModal"></div>
                <div class="form-group"><label for="leadHomeAddressModal">Home Address</label><input type="text" id="leadHomeAddressModal"></div>
                <div class="form-group"><label for="leadCompanyNameModal">Company Name</label><input type="text" id="leadCompanyNameModal"></div>
                <div class="form-group"><label for="leadDobModal">Date of Birth</label><input type="date" id="leadDobModal"></div>
                <div class="form-group"><label for="leadPipelineStageModal">Pipeline Stage</label><select id="leadPipelineStageModal"></select></div>
                <div class="form-group"><label for="leadTypeModal">Lead Type</label><select id="leadTypeModal"><option value="">Select Type...</option><option value="Buyer">Buyer</option><option value="Seller">Seller</option><option value="Investor">Investor</option><option value="Renter">Renter</option><option value="Other">Other</option></select></div>
                <div class="form-group"><label for="leadPriorityModal">Priority Level</label><select id="leadPriorityModal"><option value="Hot">Hot</option><option value="Warm" selected>Warm</option><option value="Cold">Cold</option></select></div>
                <div class="form-group"><label for="leadAssignedToModal">Assigned To</label><input type="text" id="leadAssignedToModal" placeholder="e.g., John Doe"></div>
                <div class="form-group"><label for="leadSourceModal">Source</label><select id="leadSourceModal"><option value="">Select Source...</option><option value="Website">Website</option><option value="Referral">Referral</option><option value="Social Media">Social Media</option><option value="Online Ad">Online Ad</option><option value="Open House">Open House</option><option value="Networking">Networking</option><option value="Cold Call">Cold Call</option><option value="Capture Form">Capture Form</option><option value="vCard Import">vCard Import</option><option value="USA-HUD">USA-HUD</option><option value="Other">Other</option></select></div>
                <div class="form-group"><label for="leadBudgetModal">Budget Range</label><select id="leadBudgetModal"><option value="">Select Budget...</option><option value="<200k"><$200,000</option><option value="200k-400k">$200,000 - $400,000</option><option value="400k-600k">$400,000 - $600,000</option><option value="600k-800k">$600,000 - $800,000</option><option value="800k-1M">$800,000 - $1,000,000</option><option value="1M+">$1,000,000+</option><option value="N/A">N/A (e.g. Seller)</option></select></div>
                <div class="form-group"><label for="leadFinancingStatusModal">Financing Status</label><select id="leadFinancingStatusModal"><option value="">Select Status...</option><option value="Pre-approved">Pre-approved</option><option value="Cash Buyer">Cash Buyer</option><option value="Needs Financing">Needs Financing</option><option value="Exploring Options">Exploring Options</option><option value="N/A">N/A</option></select></div>
                <div class="form-group"><label>Gender</label><div class="form-group-radio"><input type="radio" id="genderMaleModal" name="genderModal" value="Male"><label for="genderMaleModal">Male</label><input type="radio" id="genderFemaleModal" name="genderModal" value="Female"><label for="genderFemaleModal">Female</label><input type="radio" id="genderOtherModal" name="genderModal" value="Other/Prefer not to say" checked><label for="genderOtherModal">Other</label></div></div>
                <div class="form-group"><label for="leadInstagramModal">Instagram</label><input type="text" id="leadInstagramModal" placeholder="@username"></div>
                <div class="form-group"><label for="leadFacebookModal">Facebook URL</label><input type="url" id="leadFacebookModal" placeholder="https://facebook.com/username"></div>
                <div class="grid-col-span-2 form-group"><label for="leadLinkedInModal">LinkedIn URL</label><input type="url" id="leadLinkedInModal" placeholder="https://linkedin.com/in/username"></div>
                <div class="grid-col-span-2 form-group"><label for="leadTags">Tags (comma-separated)</label><input type="text" id="leadTags" placeholder="e.g., buyer, investor"></div>
                <div class="grid-col-span-2 form-group"><label for="leadNotes">Notes</label><textarea id="leadNotes" rows="3"></textarea></div>
                <div class="grid-col-span-2"><h4 style="margin-top: 1rem;">Associated Contacts</h4><div id="associatedContactsContainer"></div><button type="button" id="addAssociatedContactButton" class="button-glass-subtle">+ Add Contact</button></div>
                <div class="grid-col-span-2 modal-actions-footer"><button type="button" id="deleteLeadModalButton" class="button-glass danger-text" style="display: none;">Delete Lead</button><div><button type="button" id="saveLeadButton">Save Lead</button></div></div>
            </form>
        </div>
    </div>
    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeTaskModalButton">×</span>
            <h2 id="taskModalTitle">Add Task</h2>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <div class="form-group"><label for="taskTitleModal">Title:</label><input type="text" id="taskTitleModal" required></div>
                <div class="form-group"><label for="taskDescription">Description:</label><textarea id="taskDescription"></textarea></div>
                <div class="form-group"><label for="taskDueDateModal">Due Date:</label><input type="date" id="taskDueDateModal"></div>
                <div class="form-group"><label for="taskStatusModal">Status:</label><select id="taskStatusModal"><option value="To Do">To Do</option><option value="In Progress">In Progress</option><option value="Completed">Completed</option></select></div>
                <div class="form-group"><label for="taskAssociatedLeadModal">Associated Lead:</label><select id="taskAssociatedLeadModal"><option value="">None</option></select></div>
                <button type="button" id="saveTaskButton">Save Task</button>
            </form>
        </div>
    </div>
    <!-- Upload Document Modal -->
    <div id="uploadDocumentModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeUploadDocumentModalButton">×</span>
            <h2 id="uploadDocumentModalTitle">Upload New Document</h2>
            <form id="uploadDocumentForm">
                <input type="hidden" id="documentId">
                <div class="form-group"><label for="documentFileInput">Select File:</label><input type="file" id="documentFileInput" required></div>
                <div class="form-group"><label for="documentAssociatedLead">Associate with Lead:</label><select id="documentAssociatedLead"><option value="">None (General Document)</option></select></div>
                <div class="form-group"><label for="documentDescription">Description (Optional):</label><textarea id="documentDescription" rows="3" placeholder="e.g., Signed Purchase Agreement for 123 Main St"></textarea></div>
                <button type="button" id="saveDocumentButton">Upload and Save</button>
            </form>
        </div>
    </div>
    <!-- Select Lead Modal -->
    <div id="selectLeadModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeSelectLeadModalButton">×</span>
            <h2>Select a Lead</h2>
            <input type="text" id="leadSearchInput" placeholder="Search by name or email...">
            <div id="leadListContainer"></div>
        </div>
    </div>
    <!-- Select CC Contacts Modal -->
    <div id="selectCcModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeSelectCcModalButton">×</span>
            <h2>Select CC Contacts</h2>
            <div id="ccSelectAllContainer" style="display: none; border-bottom: 1px solid #e0e0e0; padding-bottom: 10px; margin-bottom: 10px;"><label><input type="checkbox" id="ccSelectAllCheckbox"> Select All</label></div>
            <div id="ccContactListContainer"></div>
            <div id="addNewCcContactContainer"><h4>Add New Associated Contact</h4><div id="newCcContactInputContainer"><input type="email" id="newCcContactInput" placeholder="Enter new contact's email"><button type="button" id="addNewCcContactButton" class="button-glass-subtle">Add</button></div></div>
            <button type="button" id="addSelectedToCcButton" style="margin-top: 20px;">Add Selected to CC</button>
        </div>
    </div>
    <!-- View Associated Contacts Modal -->
    <div id="viewContactsModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeViewContactsModalButton">×</span>
            <h2 id="viewContactsModalTitle">Associated Contacts</h2>
            <div id="viewContactsContent"></div>
            <div class="modal-actions-footer"><div></div><div><button type="button" id="editLeadFromContactsViewButton">Edit Lead</button></div></div>
        </div>
    </div>
    <!-- Lead Documents Modal -->
    <div id="leadDocumentsModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeLeadDocumentsModalButton">×</span>
            <h2 id="leadDocumentsModalTitle">Lead Documents</h2>
            <div id="leadDocumentsList"></div>
            <div class="modal-actions-footer"><div></div><button type="button" id="addLeadDocumentButton">Add Document</button></div>
        </div>
    </div>
    <!-- Flow Modal -->
    <div id="flowModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeFlowModalButton">×</span>
            <h2 id="flowModalTitle">Dynamic Workflow</h2>
            <div id="flowModalContent"></div>
        </div>
    </div>
    <!-- NEW: Simple Alert/Prompt Modal -->
    <div id="simpleModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <h3 id="simpleModalTitle" style="margin-top:0;">Alert</h3>
            <p id="simpleModalMessage"></p>
            <input type="text" id="simpleModalInput" style="display: none;" />
            <div id="simpleModalActions" class="modal-actions-footer" style="margin-top: 1.5rem;">
                <div></div> <!-- Spacer -->
                <div style="display: flex; gap: 1rem;">
                    <button id="simpleModalCancelBtn" class="button-glass-subtle" style="display: none;">Cancel</button>
                    <button id="simpleModalConfirmBtn">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Entry Point -->
    <script type="module" src="js/main.js"></script>
</body>
</html>